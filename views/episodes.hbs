<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <style>
      * {
        box-sizing: border-box;
        tap-highlight-color: transparent;
      }
      body {
        font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 15px;
        line-height: 1.5;
        font-size: 16px;
        color: #333;
        -webkit-text-size-adjust: 100%;
      }
      h1 {
        font-size: 20px;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e0e0e0;
      }
      ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      li {
        background: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 10px;
        padding: 12px;
      }
      a {
        text-decoration: none;
        color: #0066cc;
        transition: color 0.2s;
      }
      li > a:first-child {
        display: block;
        font-weight: bold;
        font-size: 17px;
        margin-bottom: 5px;
      }
      li > a:not(:first-child) {
        color: #666;
        font-size: 14px;
        display: inline-block;
        margin-right: 10px;
      }
      a:hover, a:active {
        color: #004080;
      }
      .controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        align-items: center;
      }
      .controls select {
        padding: 6px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <script>
      window.onload = function(){
      const topBtn = document.getElementById("top");
      topBtn.addEventListener("click", () => {
            localStorage.setItem("lastPage", "")
            window.location.href = "/"
        });

        const orderSelect = document.getElementById('order');
        const showSelect = document.getElementById('show');
        const podName = '{{pod}}';

        orderSelect.addEventListener('change', updateMeta);
        showSelect.addEventListener('change', updateMeta);

        function updateMeta() {
            const order = orderSelect.value;
            const show = showSelect.value;

            fetch('/update-meta-pod', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: podName, order, show, coreset: 'false' })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error updating settings');
                }
            });
        }
      }
    </script>

    Return to podcast list: <button id="top">‚è´</button>

    <h1>Choose an episode of {{pod}}</h1>

    <div class="controls">
        <select id="order">
            <option value="oldest" {{#if (eq meta.order "oldest")}}selected{{/if}}>Oldest First</option>
            <option value="latest" {{#if (eq meta.order "latest")}}selected{{/if}}>Newest First</option>
        </select>
        <select id="show">
            <option value="all" {{#if (eq meta.show "all")}}selected{{/if}}>Show All</option>
            <option value="unfinished" {{#if (eq meta.show "unfinished")}}selected{{/if}}>Show Unfinished</option>
        </select>
    </div>

    <ul>
    {{#each eps}}
        <div>
          <li>
            <a href="/play/{{../pod}}/{{encoded}}">
              {{#if finished}}
                ‚úÖ
              {{else}}
                üî¥
              {{/if}}
              {{displayname}} [{{info.itunes_duration}}]
            </a>
            <div style="font-size: 13px; color: #888; margin-left: 2em;">
              {{info.published}}
            </div>
          </li>
        </div>
    {{/each}}
    </ul>
  </body>
</html>
